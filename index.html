<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <!-- Add a simple favicon using emoji to avoid needing a real icon file -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üêπ</text></svg>">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#4caf50" />
    <meta
      name="description"
      content="Capybara Kart - a Mario Kart style racing game with Capybaras"
    />
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üêπ</text></svg>">
    <title>Capybara Kart</title>
    <!-- Fallback textures script -->
    <script src="/textures/fallback.js"></script>
    <!-- Dynamic texture generation scripts -->
    <script src="/textures/grass.js"></script>
    <script src="/textures/track.js"></script>
    <script src="/textures/sky.js"></script>
    <script src="/textures/capybara.js"></script>
    <script src="/textures/sand.js"></script>
    <script src="/textures/water.js"></script>
    <style>
      /* Add styles for the focus button */
      #focus-button {
        position: absolute;
        bottom: 70px;
        left: 20px;
        z-index: 1000;
        padding: 8px 16px;
        background-color: #39A649;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
      }
      
      #force-start-button {
        position: absolute;
        bottom: 20px;
        left: 20px;
        z-index: 1000;
        padding: 8px 16px;
        background-color: #E74C3C;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
      }
      
      /* Debug tools */
      #debug-tools {
        position: fixed;
        top: 10px;
        right: 10px;
        background: rgba(0,0,0,0.7);
        color: white;
        padding: 10px;
        border-radius: 4px;
        z-index: 10000;
        font-size: 12px;
      }
      
      #debug-toggle {
        background: #2196F3;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 3px;
        cursor: pointer;
      }
      
      #error-log-toggle {
        background: #f44336;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 3px;
        margin-top: 5px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    
    <!-- Debug tools -->
    <div id="debug-tools">
      <button id="debug-toggle" onclick="toggleDebugMode()">Enable Debug Mode</button>
      <button id="error-log-toggle" onclick="toggleErrorLog()">Show Error Log</button>
    </div>
    
    <!-- Focus button to help capture keyboard events -->
    <button id="focus-button" onclick="focusCanvas()">CLICK HERE TO FOCUS</button>
    
    <!-- Force race start button -->
    <button id="force-start-button" onclick="startRace()">FORCE RACE START</button>
    
    <script>
      // Debug mode functions
      function toggleDebugMode() {
        window.debugMode = !window.debugMode;
        const btn = document.getElementById('debug-toggle');
        if (window.debugMode) {
          btn.textContent = 'Disable Debug Mode';
          btn.style.background = '#ff9800';
          console.log('Debug mode enabled');
          // Display useful debugging info
          console.log('Window dimensions:', window.innerWidth, 'x', window.innerHeight);
          console.log('User agent:', navigator.userAgent);
          console.log('WebGL support:', !!document.createElement('canvas').getContext('webgl'));
          // Turn on verbose logging for THREE.js
          if (window.THREE) {
            console.log('THREE.js version:', window.THREE.REVISION);
          }
        } else {
          btn.textContent = 'Enable Debug Mode';
          btn.style.background = '#2196F3';
          console.log('Debug mode disabled');
        }
      }
      
      function toggleErrorLog() {
        const errorLog = document.getElementById('error-log');
        if (errorLog) {
          errorLog.style.display = errorLog.style.display === 'none' ? 'block' : 'none';
          document.getElementById('error-log-toggle').textContent = 
            errorLog.style.display === 'none' ? 'Show Error Log' : 'Hide Error Log';
        }
      }
      
      // Intercept console errors to display in our error log
      window.addEventListener('error', function(event) {
        const errorLog = document.getElementById('error-log');
        if (errorLog) {
          errorLog.style.display = 'block';
          const errorElement = document.createElement('div');
          errorElement.style.color = 'red';
          errorElement.style.margin = '10px 0';
          errorElement.textContent = `JS Error: ${event.message} at ${event.filename}:${event.lineno}`;
          errorLog.appendChild(errorElement);
        }
      });
      
      // Add load event to check WebGL support
      window.addEventListener('load', function() {
        // Show initial debug message
        console.log('Page loaded, checking WebGL support...');
        
        // Check WebGL support
        const canvas = document.createElement('canvas');
        const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
        
        if (!gl) {
          console.error('WebGL not supported or enabled! Game requires WebGL to run.');
          const errorLog = document.getElementById('error-log');
          if (errorLog) {
            errorLog.style.display = 'block';
            const errorElement = document.createElement('div');
            errorElement.style.color = 'red';
            errorElement.style.fontWeight = 'bold';
            errorElement.style.margin = '10px 0';
            errorElement.textContent = 'ERROR: WebGL not supported or enabled! Game requires WebGL to run.';
            errorLog.appendChild(errorElement);
          }
        } else {
          console.log('WebGL is supported!', gl);
        }
        
        // Make sure the error log is visible by default in case there were earlier errors
        document.getElementById('error-log-toggle').click();
      });
      
      function focusCanvas() {
        // Find the canvas element and focus it
        const canvas = document.querySelector('canvas');
        if (canvas) {
          canvas.focus();
          canvas.setAttribute('tabindex', '0'); // Make canvas focusable
          console.log("Canvas focused via button click");

          // Force the game to recognize that keys should start working
          // This will trigger key events that the game can process
          const forceKeyEvent = (key) => {
            // Create keydown event
            const keyDownEvent = new KeyboardEvent('keydown', {
              code: key,
              key: key,
              bubbles: true,
              cancelable: true
            });
            // Create keyup event
            const keyUpEvent = new KeyboardEvent('keyup', {
              code: key,
              key: key,
              bubbles: true,
              cancelable: true
            });
            
            // Dispatch events
            window.dispatchEvent(keyDownEvent);
            setTimeout(() => window.dispatchEvent(keyUpEvent), 10);
            
            console.log(`Sent force key event for: ${key}`);
          };
          
          // Send events for arrow keys to initialize them
          setTimeout(() => {
            forceKeyEvent('ArrowUp');
            forceKeyEvent('ArrowDown');
            forceKeyEvent('ArrowLeft');
            forceKeyEvent('ArrowRight');
          }, 100);
        }
      }
      
      function startRace() {
        // Call the global function exposed by Game3DCanvas
        if (window.forceRaceStart) {
          window.forceRaceStart();
          console.log("Force race start triggered via button");
          
          // Focus the canvas after starting the race
          setTimeout(focusCanvas, 500);
        } else {
          console.error("forceRaceStart function not found!");
        }
      }
    </script>
    
    <!-- Script entry point for Vite -->
    <script type="module" src="/src/index.js"></script>
  </body>
</html> 